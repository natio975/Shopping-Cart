<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Collocation Catcher</title>
    <style>
        html, body {
            overscroll-behavior: none;
            margin: 0;
            padding: 0;
            background: #f0f0f0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }
        
        .game-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            height: 650px;
            background: url('https://i.postimg.cc/4dhsG56N/1763915725.png') center/cover no-repeat;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            margin: 10px auto;
        }
        
        #gameCanvas {
            display: block;
            width: 800px;
            height: 600px;
            background: transparent;
            touch-action: none;
        }

        .top-bar {
            position: absolute;
            top: 15px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box;
            z-index: 10;
        }

        .stat-display {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            background: rgba(255, 255, 255, 0.92);
            padding: 5px 10px;
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            min-width: 90px;
        }

        .game-controls {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.92);
            padding: 6px 16px;
            border-radius: 10px;
            font-size: 14px;
            color: #555;
            z-index: 10;
        }

        .ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            justify-content: center;
            align-items: center;
            background: rgba(0,0,0,0.7);
            color: white;
            z-index: 100;
        }
        
        /* ‚úÖ –ù–ï–ñ–ù–û-–ó–ï–õ–Å–ù–´–ô –¶–í–ï–¢ –ü–õ–ê–®–ö–ò */
        .quiz-container {
            background: #e8f5e9;
            padding: 25px;
            border-radius: 16px;
            color: black;
            max-width: 500px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.25);
            position: relative;
            border-top: 4px solid #4CAF50;
        }
        
        .quiz-question {
            font-size: 20px;
            margin-bottom: 20px;
            color: #222;
            line-height: 1.4;
            text-align: center;
        }
        
        .quiz-option-row {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 14px;
        }
        
        .quiz-option-single {
            display: flex;
            justify-content: center;
            margin-top: 8px;
        }
        
        .quiz-option {
            padding: 14px;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            font-size: 17px;
            text-align: center;
            transition: all 0.25s;
            min-width: 120px;
            box-sizing: border-box;
        }
        
        .quiz-option:hover {
            background: #e3f2fd;
            transform: translateY(-2px);
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-6px); }
            75% { transform: translateX(6px); }
        }
        .quiz-option.wrong {
            animation: shake 0.4s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
            border-color: #f44336;
            background-color: #ffebee;
        }

        .score-bonus {
            position: absolute;
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
            pointer-events: none;
            z-index: 1000;
            text-shadow: 0 0 6px white;
            animation: floatUp 1s forwards;
        }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-60px); }
        }

        .help-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: #4CAF50;
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            z-index: 300;
        }

        .help-btn:hover {
            background: #45a049;
            transform: scale(1.05);
        }

        .instructions-modal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 400;
        }

        .instructions-content {
            background: white;
            padding: 30px;
            border-radius: 16px;
            max-width: 500px;
            text-align: left;
            font-size: 18px;
            line-height: 1.5;
        }

        .instructions-content h2 {
            color: #333;
            margin-top: 0;
            text-align: center;
        }

        .instructions-content ul {
            padding-left: 20px;
        }

        .instructions-content li {
            margin-bottom: 10px;
        }

        .close-btn {
            display: block;
            margin: 20px auto 0;
            padding: 8px 20px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }

        .start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
            background: url('https://i.postimg.cc/4dhsG56N/1763915725.png') center/cover no-repeat;
            color: blue;
            text-shadow: 0 0 5px black;
        }
        
        .start-title {
            font-size: clamp(28px, 6vw, 36px);
            color: white;
            margin-bottom: 40px;
            text-shadow: 0 0 5px grey;
            background: rgba(0, 0, 0, 0.6);
            padding: 10px 20px;
            border-radius: 12px;
            display: inline-block;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 90vw;
        }
        
        .start-btn {
            padding: 10px 18px;
            font-size: clamp(16px, 4vw, 20px);
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-family: inherit;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .author-badge {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 6px 14px;
            border-radius: 12px;
            font-size: clamp(14px, 3.5vw, 16px);
            font-weight: 600;
            text-shadow: 0 0 3px black;
            letter-spacing: 0.5px;
            z-index: 210;
        }
        
        .win-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            z-index: 200;
        }

        .win-container {
            background: rgba(30, 30, 30, 0.95);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .win-title {
            font-size: clamp(32px, 8vw, 42px);
            color: gold;
            margin-bottom: 15px;
            text-shadow: 0 0 15px gold;
        }

        .win-subtitle {
            font-size: clamp(18px, 5vw, 20px);
            color: #eee;
            margin-bottom: 25px;
            line-height: 1.4;
        }

        .play-again-btn {
            padding: 12px 32px;
            font-size: clamp(16px, 4vw, 20px);
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-family: inherit;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 810px) {
            .game-container {
                width: 100vw;
                height: 100vh;
                max-width: 100%;
                max-height: 100vh;
                border-radius: 0;
                margin: 0;
            }
            
            #gameCanvas {
                width: 100% !important;
                height: 100% !important;
            }
            
            .top-bar {
                top: 10px;
                padding: 0 10px;
                flex-wrap: wrap;
                justify-content: center;
                gap: 8px;
            }
            
            .stat-display {
                font-size: 12px;
                padding: 3px 6px;
                min-width: 60px;
            }
            
            .game-controls {
                font-size: 11px;
                bottom: 5px;
                padding: 3px 10px;
                white-space: nowrap;
            }
            
            .quiz-container {
                margin: 15px;
                padding: 15px;
                max-width: 90%;
            }
            
            .quiz-question {
                font-size: 16px;
                margin-bottom: 15px;
            }
            
            .quiz-option {
                font-size: 14px;
                padding: 10px;
                min-width: 80px;
            }
            
            .help-btn {
                top: 8px;
                right: 8px;
                width: 30px;
                height: 30px;
                font-size: 16px;
            }
            
            .author-badge {
                bottom: 8px;
                right: 8px;
                padding: 3px 8px;
                font-size: 11px;
            }
        }

        /* –î–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (max-width: 480px) {
            .quiz-option-row {
                flex-direction: column;
                gap: 6px;
            }
            
            .quiz-option {
                min-width: auto;
                width: 100%;
                font-size: 13px;
                padding: 8px;
            }
            
            .stat-display {
                font-size: 11px;
                min-width: 55px;
                padding: 2px 4px;
            }
            
            .top-bar {
                gap: 5px;
            }
            
            .game-controls {
                font-size: 10px;
                padding: 2px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <div class="top-bar">
            <div class="stat-display">Score: <span id="score">0</span></div>
            <div class="stat-display">Misses: <span id="misses">0</span></div>
            <div class="stat-display">Lives: <span id="lives">3</span></div>
        </div>
        
        <div class="game-controls" id="gameControls">
            Use ‚Üê ‚Üí arrow keys or mouse to move the cart
        </div>
        
        <div class="ui-overlay" id="quizOverlay">
            <div class="quiz-container">
                <div class="quiz-question" id="quizQuestion"></div>
                <div id="quizOptions"></div>
            </div>
        </div>
        
        <div class="start-screen" id="startScreen">
            <h1 class="start-title">üõí Collocation Catcher</h1>
            <div style="margin-top: 10px; display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                <button class="start-btn" style="background:#4CAF50;" onclick="startGame('easy')">Easy</button>
                <button class="start-btn" style="background:#f44336;" onclick="startGame('hard')">Hard</button>
            </div>
            <div class="help-btn" onclick="showInstructions()">?</div>
            <div class="author-badge" id="authorBadge">@ioffenat</div>
        </div>
        
        <div class="win-screen" id="winScreen">
            <div class="win-container">
                <h1 class="win-title">üéâ Congratulations!</h1>
                <p class="win-subtitle">You mastered measure words!</p>
                <button class="play-again-btn" onclick="resetGame()">Play Again</button>
            </div>
        </div>

        <div class="instructions-modal" id="instructionsModal">
            <div class="instructions-content">
                <h2>How to Play</h2>
                <ul>
                    <li>üü¢ Catch falling items with your shopping cart.</li>
                    <li>üü¢ Every 5 points, a quiz appears.</li>
                    <li>üü¢ Choose the correct word to complete the sentence.</li>
                    <li>üü¢ You must find the right answer to continue!</li>
                    <li>üü¢ Get <strong>+5 points</strong> for a correct answer on the first try.</li>
                    <li>üü¢ Reach <strong>100 points</strong> to win!</li>
                </ul>
                <button class="close-btn" onclick="hideInstructions()">Close</button>
            </div>
        </div>
    </div>

    <script>
        const itemUrls = {
            "jar of jam": "https://i.postimg.cc/YvZr3mMr/10.png",
            "can of cola": "https://i.postimg.cc/MGdVNgVV/Untitled-design-(2).png",
            "bottle of cola": "https://i.postimg.cc/75fP0N8L/7.png",
            "carton of milk": "https://i.postimg.cc/CRzMk4TV/4.png",
            "loaf of bread": "https://i.postimg.cc/DS8fLck3/5.png",
            "bar of chocolate": "https://i.postimg.cc/0zb5DCRx/6.png",
            "packet of rice": "https://i.postimg.cc/wy99T1Jw/7.png",
            "tin of tuna": "https://i.postimg.cc/BjkSg14j/Untitled-design.png",
            "carton of juice": "https://i.postimg.cc/G4H3Gjw8/9.png"
        };

        const itemImages = {};
        for (const key in itemUrls) {
            itemImages[key] = new Image();
            itemImages[key].src = itemUrls[key];
        }

        const quizQuestions = [
            // Food & Drinks
            { question: "I opened a ______ of tuna for lunch.", options: ["tin", "jar", "bottle"], answer: "tin" },
            { question: "She drank a ______ of water after running.", options: ["glass", "loaf", "bar"], answer: "glass" },
            { question: "There's a ______ of juice on the table for everyone.", options: ["bottle", "can", "packet"], answer: "bottle" },
            { question: "Would you like a ______ of tea?", options: ["cup", "bowl", "kilo"], answer: "cup" },
            { question: "We need to buy a ______ of rice for dinner.", options: ["packet", "bottle", "bar"], answer: "packet" },
            { question: "She put a ______ of honey on her toast.", options: ["jar", "can", "loaf"], answer: "jar" },
            { question: "I bought a fresh ______ of bread from the bakery.", options: ["loaf", "bar", "bottle"], answer: "loaf" },
            { question: "Can I have a ______ of bread with my soup?", options: ["slice", "kilo", "packet"], answer: "slice" },
            { question: "The children drink a ______ of milk every day.", options: ["carton", "glass", "bowl"], answer: "carton" },
            { question: "He opened a ______ of cola from the fridge.", options: ["can", "jar", "loaf"], answer: "can" },
            { question: "We bought a ______ of cola for the party.", options: ["bottle", "packet", "bar"], answer: "bottle" },
            { question: "She served a ______ of rice with the curry.", options: ["bowl", "cup", "glass"], answer: "bowl" },
            { question: "I need to buy a ______ of meat for dinner.", options: ["kilo", "jar", "bottle"], answer: "kilo" },
            
            // Household & Other items
            { question: "There's a new ______ of soap in the bathroom.", options: ["bar", "can", "packet"], answer: "bar" },
            { question: "He gave her a ______ of chocolate for her birthday.", options: ["bar", "bottle", "loaf"], answer: "bar" },
            { question: "We need a ______ of flour to make cookies.", options: ["bag", "jar", "can"], answer: "bag" },
            { question: "Would you like a ______ of cheese with your apple?", options: ["piece", "slice", "bar"], answer: "piece" },
            { question: "They bought a new ______ of furniture for the living room.", options: ["piece", "bar", "bottle"], answer: "piece" },
            
            // Mixed variations for more diversity
            { question: "My grandmother keeps a ______ of honey in her cupboard.", options: ["jar", "can", "bottle"], answer: "jar" },
            { question: "For breakfast, I have a ______ of bread with butter.", options: ["slice", "piece", "bar"], answer: "slice" },
            { question: "The recipe requires one ______ of flour.", options: ["bag", "packet", "jar"], answer: "bag" },
            { question: "He drinks at least two ______ of water every day.", options: ["glasses", "jars", "cans"], answer: "glasses" },
            { question: "We need a large ______ of water for the picnic.", options: ["bottle", "packet", "can"], answer: "bottle" },
            { question: "She always has a ______ of tea in the morning.", options: ["cup", "bowl", "glass"], answer: "cup" },
            { question: "The supermarket had a special offer on ______ of cola.", options: ["cans", "jars", "loaves"], answer: "cans" },
            { question: "I prefer to buy ______ of cola rather than cans.", options: ["bottles", "jars", "packets"], answer: "bottles" },
            { question: "The restaurant served a huge ______ of rice with the meal.", options: ["bowl", "cup", "glass"], answer: "bowl" },
            { question: "Could you pass me that ______ of bread please?", options: ["loaf", "bar", "bottle"], answer: "loaf" },
            { question: "There's only one ______ of milk left in the fridge.", options: ["carton", "jar", "can"], answer: "carton" },
            { question: "I'd like a small ______ of chocolate for dessert.", options: ["bar", "loaf", "bottle"], answer: "bar" },
            { question: "This old ______ of furniture has been in our family for years.", options: ["piece", "bar", "packet"], answer: "piece" },
            { question: "We bought three ______ of meat for the barbecue.", options: ["kilos", "jars", "bottles"], answer: "kilos" }
        ];

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        const cartImage = new Image();
        cartImage.src = "https://i.postimg.cc/sx5BjSF7/4.png";

        // ‚úÖ –ë–æ–ª–µ–µ —É–∑–∫–∞—è –∏–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        let GAME_AREA_LEFT = 80;
        let GAME_AREA_RIGHT = 720;
        let GAME_AREA_WIDTH = GAME_AREA_RIGHT - GAME_AREA_LEFT;

        const CART_TARGET_HEIGHT = 140;

        // –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
        let canvasScale = 1;
        let originalWidth = 800;
        let originalHeight = 600;

        let cart = { 
            x: GAME_AREA_LEFT + (GAME_AREA_WIDTH - 140) / 2,
            y: canvas.height - 160,
            width: 140, 
            height: CART_TARGET_HEIGHT 
        };

        let score = 0;
        let lives = 3;
        let misses = 0;
        let gameRunning = false;
        let items = [];
        let lastItemTime = 0;
        let quizActive = false;
        let lastQuizScore = 0;
        let shuffledQuizQuestions = [];
        let currentDifficulty = 'easy';

        const difficultySettings = {
            easy: {
                lives: 5,
                cartWidth: 180,
                spawnInterval: 1500,
                speedMin: 1.0,
                speedMax: 1.5,
                initialDelay: 2000
            },
            hard: {
                lives: 3,
                cartWidth: 120,
                spawnInterval: 1000,
                speedMin: 1.4,
                speedMax: 2.0,
                initialDelay: 1500
            }
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –∫–∞–Ω–≤–∞—Å–∞
        function resizeCanvas() {
            const container = document.querySelector('.game-container');
            const canvas = document.getElementById('gameCanvas');
            
            if (window.innerWidth <= 810) {
                // –ú–æ–±–∏–ª—å–Ω—ã–π —Ä–µ–∂–∏–º - –∑–∞–Ω–∏–º–∞–µ–º –≤–µ—Å—å —ç–∫—Ä–∞–Ω
                canvas.style.width = '100%';
                canvas.style.height = '100%';
                canvas.width = container.clientWidth;
                canvas.height = container.clientHeight;
                
                // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –∏–≥—Ä–æ–≤—É—é –ª–æ–≥–∏–∫—É
                canvasScale = Math.min(container.clientWidth / originalWidth, container.clientHeight / originalHeight);
                
                // –£–∂–µ–∂–µ –∏–≥—Ä–æ–≤—É—é –∑–æ–Ω—É –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
                const mobileGameAreaRatio = 0.7;
                const gameAreaWidthMobile = canvas.width * mobileGameAreaRatio;
                
                GAME_AREA_LEFT = (canvas.width - gameAreaWidthMobile) / 2;
                GAME_AREA_RIGHT = GAME_AREA_LEFT + gameAreaWidthMobile;
                GAME_AREA_WIDTH = gameAreaWidthMobile;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä —Ç–µ–ª–µ–∂–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
                cart.width = difficultySettings[currentDifficulty].cartWidth * canvasScale * 0.9;
                cart.height = CART_TARGET_HEIGHT * canvasScale * 0.9;
                cart.y = canvas.height - 140 * canvasScale;
                
            } else {
                // –î–µ—Å–∫—Ç–æ–ø —Ä–µ–∂–∏–º - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä
                canvas.style.width = '800px';
                canvas.style.height = '600px';
                canvas.width = 800;
                canvas.height = 600;
                canvasScale = 1;
                
                // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –∏–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞
                GAME_AREA_LEFT = 80;
                GAME_AREA_RIGHT = 720;
                GAME_AREA_WIDTH = GAME_AREA_RIGHT - GAME_AREA_LEFT;
                
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã
                cart.width = difficultySettings[currentDifficulty].cartWidth;
                cart.height = CART_TARGET_HEIGHT;
                cart.y = canvas.height - 160;
            }
            
            // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Ç–µ–ª–µ–∂–∫—É
            cart.x = GAME_AREA_LEFT + (GAME_AREA_WIDTH - cart.width) / 2;
            
            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∏–≥—Ä—É –µ—Å–ª–∏ –æ–Ω–∞ –∑–∞–ø—É—â–µ–Ω–∞
            if (gameRunning) {
                drawGame();
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏ –∏–≥—Ä—ã
        function drawGame() {
            if (!gameRunning) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (!quizActive) update();
            drawItems();
            drawCart();
            drawGameAreaBounds();
        }

        // –í—Ä–µ–º–µ–Ω–Ω–æ –¥–æ–±–∞–≤–∏–º –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã –∏–≥—Ä–æ–≤–æ–π –∑–æ–Ω—ã
        function drawGameAreaBounds() {
            if (window.innerWidth <= 810) {
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
                ctx.lineWidth = 1;
                ctx.strokeRect(GAME_AREA_LEFT, 0, GAME_AREA_WIDTH, canvas.height);
            }
        }

        function showScoreBonus(containerElement) {
            const bonus = document.createElement('div');
            bonus.className = 'score-bonus';
            bonus.textContent = '+5';
            
            const rect = containerElement.getBoundingClientRect();
            bonus.style.left = (rect.left + rect.width / 2 - 20) + 'px';
            bonus.style.top = (rect.top - 40) + 'px';
            
            document.body.appendChild(bonus);
            setTimeout(() => {
                if (bonus.parentNode) {
                    bonus.parentNode.removeChild(bonus);
                }
            }, 1000);
        }

        function showInstructions() {
            document.getElementById('instructionsModal').style.display = 'flex';
        }

        function hideInstructions() {
            document.getElementById('instructionsModal').style.display = 'none';
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function areAllImagesLoaded() {
            const itemsLoaded = Object.values(itemImages).every(img => img.complete && img.width > 0);
            return itemsLoaded && cartImage.complete;
        }

        function initGame() {
            const settings = difficultySettings[currentDifficulty];
            gameRunning = true;
            score = 0;
            lives = settings.lives;
            misses = 0;
            lastQuizScore = 0;
            items = [];
            shuffledQuizQuestions = shuffleArray(quizQuestions);
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
            resizeCanvas();
            
            updateScore(); updateLives(); updateMisses();
            document.getElementById('gameControls').style.display = 'none';
            document.getElementById('authorBadge').style.display = 'none';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –ø—Ä–µ–¥–º–µ—Ç–æ–º
            lastItemTime = Date.now() + settings.initialDelay;
            
            gameLoop();
        }

        function startGameWhenReady() {
            if (areAllImagesLoaded()) {
                score = 0;
                initGame();
            } else {
                setTimeout(startGameWhenReady, 100);
            }
        }

        function startGame(difficulty = 'easy') {
            currentDifficulty = difficulty;
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('winScreen').style.display = 'none';
            startGameWhenReady();
        }

        function resetGame() {
            document.getElementById('winScreen').style.display = 'none';
            document.getElementById('startScreen').style.display = 'flex';
            document.getElementById('gameControls').style.display = 'block';
            document.getElementById('authorBadge').style.display = 'block';
        }

        function updateScore() { document.getElementById('score').textContent = score; }
        function updateLives() { document.getElementById('lives').textContent = lives; }
        function updateMisses() { document.getElementById('misses').textContent = misses; }

        function createItem() {
            const keys = Object.keys(itemImages);
            const key = keys[Math.floor(Math.random() * keys.length)];
            const img = itemImages[key];

            if (!img.complete || img.width === 0 || img.height === 0) return;

            let targetHeight = (60 + Math.random() * 10) * canvasScale;
            if (key === "packet of rice") {
                targetHeight *= 1.5;
            }

            const scale = targetHeight / img.height;
            const w = img.width * scale;
            const h = targetHeight;

            const settings = difficultySettings[currentDifficulty];
            const speed = (settings.speedMin + Math.random() * (settings.speedMax - settings.speedMin)) * canvasScale;

            // ‚úÖ –ü—Ä–µ–¥–º–µ—Ç—ã –ø–∞–¥–∞—é—Ç –¢–û–õ–¨–ö–û –≤ —É–∑–∫–æ–π —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –∑–æ–Ω–µ
            items.push({
                x: GAME_AREA_LEFT + Math.random() * (GAME_AREA_WIDTH - w),
                y: -h,
                width: w,
                height: h,
                speed: speed,
                key: key
            });
        }

        function drawCart() {
            if (cartImage.complete && cartImage.width > 0) {
                const scale = (CART_TARGET_HEIGHT * canvasScale) / cartImage.height;
                const w = cartImage.width * scale;
                const h = CART_TARGET_HEIGHT * canvasScale;
                ctx.drawImage(cartImage, cart.x, cart.y, w, h);
            } else {
                ctx.fillStyle = '#4a5568';
                ctx.fillRect(cart.x, cart.y, cart.width, cart.height);
            }
        }

        function drawItems() {
            items.forEach(item => {
                const img = itemImages[item.key];
                if (img && img.complete && img.width > 0) {
                    ctx.drawImage(img, item.x, item.y, item.width, item.height);
                }
            });
        }

        function update() {
            for (let i = items.length - 1; i >= 0; i--) {
                items[i].y += items[i].speed;
                
                if (items[i].y + items[i].height > cart.y &&
                    items[i].x + items[i].width > cart.x &&
                    items[i].x < cart.x + cart.width) {
                    items.splice(i, 1);
                    score += 1;
                    updateScore();
                    
                    if (score >= 5 && score <= 100 && score > lastQuizScore && score % 5 === 0) {
                        showQuiz();
                        lastQuizScore = score;
                    }
                    
                    if (score >= 100 && gameRunning) {
                        winGame();
                    }
                }
                else if (items[i].y > canvas.height) {
                    items.splice(i, 1);
                    lives--; misses++;
                    updateLives(); updateMisses();
                    if (lives <= 0) gameOver();
                }
            }
            
            const settings = difficultySettings[currentDifficulty];
            const timeSinceStart = Date.now() - (lastItemTime - settings.initialDelay);
            if (!quizActive && timeSinceStart > settings.initialDelay && Date.now() - lastItemTime > settings.spawnInterval) {
                createItem();
                lastItemTime = Date.now();
            }
        }

        function showQuiz() {
            quizActive = true;
            const quizIndex = Math.floor((score - 5) / 5);
            const q = shuffledQuizQuestions[quizIndex % shuffledQuizQuestions.length];
            document.getElementById('quizQuestion').textContent = q.question;
            const cont = document.getElementById('quizOptions');
            cont.innerHTML = '';

            const shuffledOptions = [...q.options]
                .map(value => ({ value, sort: Math.random() }))
                .sort((a, b) => a.sort - b.sort)
                .map(({ value }) => value);

            let firstAttempt = true;

            const topRow = document.createElement('div');
            topRow.className = 'quiz-option-row';
            const bottomRow = document.createElement('div');
            bottomRow.className = 'quiz-option-single';

            for (let i = 0; i < Math.min(2, shuffledOptions.length); i++) {
                const opt = shuffledOptions[i];
                const el = document.createElement('div');
                el.className = 'quiz-option';
                el.textContent = opt;
                el.onclick = function() {
                    if (opt !== q.answer) {
                        this.classList.add('wrong');
                        setTimeout(() => this.classList.remove('wrong'), 400);
                        firstAttempt = false;
                    } else {
                        if (firstAttempt) {
                            score += 5;
                            updateScore();
                            showScoreBonus(document.querySelector('.quiz-container'));
                        }
                        document.getElementById('quizOverlay').style.display = 'none';
                        quizActive = false;
                    }
                };
                topRow.appendChild(el);
            }

            if (shuffledOptions.length > 2) {
                const opt = shuffledOptions[2];
                const el = document.createElement('div');
                el.className = 'quiz-option';
                el.textContent = opt;
                el.onclick = function() {
                    if (opt !== q.answer) {
                        this.classList.add('wrong');
                        setTimeout(() => this.classList.remove('wrong'), 400);
                        firstAttempt = false;
                    } else {
                        if (firstAttempt) {
                            score += 5;
                            updateScore();
                            showScoreBonus(document.querySelector('.quiz-container'));
                        }
                        document.getElementById('quizOverlay').style.display = 'none';
                        quizActive = false;
                    }
                };
                bottomRow.appendChild(el);
            }

            cont.appendChild(topRow);
            if (shuffledOptions.length > 2) {
                cont.appendChild(bottomRow);
            }
            
            document.getElementById('quizOverlay').style.display = 'flex';
        }

        function gameOver() {
            gameRunning = false;
            alert(`Game Over! Final score: ${score}`);
            document.getElementById('startScreen').style.display = 'flex';
        }

        function winGame() {
            gameRunning = false;
            document.getElementById('winScreen').style.display = 'flex';
        }

        function gameLoop() {
            if (!gameRunning) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (!quizActive) update();
            drawItems();
            drawCart();
            drawGameAreaBounds();
            requestAnimationFrame(gameLoop);
        }

        function handlePointerMove(clientX) {
            if (!gameRunning || quizActive) return;
            const rect = canvas.getBoundingClientRect();
            const canvasX = ((clientX - rect.left) / rect.width) * canvas.width;
            
            // ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ —É–∑–∫–æ–π –∏–≥—Ä–æ–≤–æ–π –∑–æ–Ω–µ
            cart.x = Math.max(GAME_AREA_LEFT, Math.min(GAME_AREA_RIGHT - cart.width, canvasX - cart.width / 2));
        }

        canvas.addEventListener('mousemove', (e) => {
            handlePointerMove(e.clientX);
        });

        canvas.addEventListener('touchstart', (e) => {
            if (gameRunning && !quizActive) {
                e.preventDefault();
            }
        }, { passive: false });

        canvas.addEventListener('touchmove', (e) => {
            if (gameRunning && !quizActive) {
                e.preventDefault();
                handlePointerMove(e.touches[0].clientX);
            }
        }, { passive: false });

        document.addEventListener('keydown', (e) => {
            if (!gameRunning || quizActive) return;
            if (e.key === 'ArrowLeft') cart.x = Math.max(GAME_AREA_LEFT, cart.x - 20);
            else if (e.key === 'ArrowRight') cart.x = Math.min(GAME_AREA_RIGHT - cart.width, cart.x + 20);
        });

        // –î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
        window.addEventListener('load', resizeCanvas);
        window.addEventListener('resize', resizeCanvas);
        window.addEventListener('orientationchange', resizeCanvas);
    </script>
</body>
</html>
